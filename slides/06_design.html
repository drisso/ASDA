<!DOCTYPE html>
<html lang="en"><head>
<script src="06_design_files/libs/clipboard/clipboard.min.js"></script>
<script src="06_design_files/libs/quarto-html/tabby.min.js"></script>
<script src="06_design_files/libs/quarto-html/popper.min.js"></script>
<script src="06_design_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="06_design_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="06_design_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="06_design_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Davide Risso">
  <title>Experimental design</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="06_design_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="06_design_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="06_design_files/libs/revealjs/dist/theme/quarto-bbe7401fe57d4b791b917637bb662036.css">
  <link href="06_design_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="06_design_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="06_design_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="06_design_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Experimental design</h1>
  <p class="subtitle">Advanced Statistics and Data Analysis</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Davide Risso 
</div>
</div>
</div>

</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="experimental-design" class="slide level2">
<h2>Experimental design</h2>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Quote</strong></p>
</div>
<div class="callout-content">
<p>“To consult the statistician after an experiment is finished is often merely to ask him to conduct a post mortem examination. He can perhaps say what the experiment died of.”</p>
<p>R.A. Fisher (1938)</p>
</div>
</div>
</div>
</section>
<section id="what-is-experimental-design" class="slide level2">
<h2>What is experimental design?</h2>
<p>Experimental design is the field of statistics dealing with how to collect data so that the results will best be able to answer the question of interest.</p>
<div class="fragment">
<p>Generally, we want to compare/manipulate: e.g.&nbsp;try two different scenarios and see the effect on a certain response variable.</p>
</div>
<div class="fragment">
<p>The term “Experiment” implies labs, test tubes, etc. but it is much broader. We refer to “experiments” whenever there is a choice by the investigator to assign one of multiple treatments to each unit in the study.</p>
</div>
</section>
<section id="what-is-experimental-design-1" class="slide level2">
<h2>What is experimental design?</h2>
<p><a href="https://www.huber.embl.de/msmb/13-chap.html#sec-design-typesexps">Holmes and Huber</a> call experimental design <em>the art of good enough</em>.</p>
<ul>
<li class="fragment">Experimental design rationalizes the tradeoffs imposed by having finite resources.</li>
<li class="fragment">Sample sizes are limited for practical, economic, and sometimes ethical reasons.</li>
<li class="fragment">Our measurements may be overlaid with nuisance factors over which we have limited control.</li>
<li class="fragment">There is little point in prescribing unrealistic ideals: we need to make pragmatic choices that are feasible.</li>
</ul>
</section>
<section id="types-of-experiments" class="slide level2 smaller">
<h2>Types of experiments</h2>
<p>In order on how much we can control.</p>
<ul>
<li class="fragment"><strong>Experiment</strong> (proper)
<ul>
<li class="fragment">Everyting is controlled</li>
</ul></li>
<li class="fragment"><strong>Prospective, controlled studies</strong>
<ul>
<li class="fragment">E.g., clinical trials</li>
<li class="fragment">randomization, blinding</li>
<li class="fragment">ethical constraints</li>
</ul></li>
<li class="fragment"><strong>Retrospective observational studies</strong>: we lack control on
<ul>
<li class="fragment">study participants’ behavior</li>
<li class="fragment">assignment of factors</li>
<li class="fragment">confounding</li>
</ul></li>
<li class="fragment"><strong>Meta analysis</strong>
<ul>
<li class="fragment">Retrospective analysis of data that has already been collected</li>
</ul></li>
</ul>
</section>
<section id="is-this-statistics" class="slide level2">
<h2>Is this statistics?</h2>
<ul>
<li class="fragment"><p>In order to design a sensible experiment, one must know how they will analyze the data.</p></li>
<li class="fragment"><p>The design of an experiment is based on statistical properties of the analysis (and data).</p></li>
<li class="fragment"><p>Understanding the analysis will lead to understanding how the data should best be collected.</p></li>
<li class="fragment"><p><strong>In order to correctly analyze, we must understand the design</strong>.</p></li>
</ul>
</section>
<section id="is-this-statistics-1" class="slide level2">
<h2>Is this statistics?</h2>
<ul>
<li class="fragment"><p>Much of applied statistics involves more than just analysis.</p></li>
<li class="fragment"><p>Even if you are not involved in the design (or there is no design at all) experimental design can help analyze the data.</p></li>
<li class="fragment"><p>What would a well-designed experiment look like?</p></li>
<li class="fragment"><p>What can/cannot answer with this design? (Maybe nothing at all!)</p></li>
</ul>
</section></section>
<section>
<section id="confounding" class="title-slide slide level1 center">
<h1>Confounding</h1>

</section>
<section id="a-toy-example" class="slide level2">
<h2>A toy example</h2>
<ul>
<li class="fragment"><p>Assume that we want to study whether a certain <em>treatment</em> affect a certain protein expression.</p></li>
<li class="fragment"><p>We may design an experiment in which we give the treatment to a certain number of mice, say six, and measure the protein expression.</p></li>
<li class="fragment"><p>To minimize variability, all mice come from the same litter.</p></li>
<li class="fragment"><p>What can we conclude from the results in the next slide?</p></li>
</ul>
</section>
<section id="a-toy-example-1" class="slide level2">
<h2>A toy example</h2>

<img data-src="06_design_files/figure-revealjs/unnamed-chunk-1-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="a-toy-example-with-controls" class="slide level2">
<h2>A toy example (with controls)</h2>
<ul>
<li class="fragment"><p>We need a reference point to understand if the expression is high or low.</p></li>
<li class="fragment"><p>We can measure the protein expression on another six mice (from another litter), to which we did not give the treatment.</p></li>
<li class="fragment"><p>What can we conclude from the results in the next slide?</p></li>
</ul>
</section>
<section id="a-toy-example-with-controls-1" class="slide level2">
<h2>A toy example (with controls)</h2>

<img data-src="06_design_files/figure-revealjs/unnamed-chunk-2-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="a-toy-example-with-controls-2" class="slide level2">
<h2>A toy example (with controls)</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expression ~ treatment)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.1671 -0.4688 -0.1095  0.6277  1.0485 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        1.0776     0.2982   3.614  0.00474 ** 
treatmentcontrol   2.6447     0.4217   6.271 9.25e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7304 on 10 degrees of freedom
Multiple R-squared:  0.7973,    Adjusted R-squared:  0.777 
F-statistic: 39.33 on 1 and 10 DF,  p-value: 9.247e-05</code></pre>
</div>
</div>
</section>
<section id="are-you-sure" class="slide level2">
<h2>Are you sure?</h2>
<ul>
<li class="fragment"><p>We need a reference point to understand if the expression is high or low.</p></li>
<li class="fragment"><p>We can measure the protein expression on another six mice (<strong>from another litter</strong>), to which we did not give the treatment.</p></li>
<li class="fragment"><p>What can we <strong>really</strong> conclude from the results in the next slide?</p></li>
</ul>
</section>
<section id="a-toy-example-with-confounding" class="slide level2">
<h2>A toy example (with confounding)</h2>

<img data-src="06_design_files/figure-revealjs/unnamed-chunk-4-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="a-toy-example-with-confounding-1" class="slide level2">
<h2>A toy example (with confounding)</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expression ~ treatment + litter, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.1671 -0.4688 -0.1095  0.6277  1.0485 

Coefficients: (1 not defined because of singularities)
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        1.0776     0.2982   3.614  0.00474 ** 
treatmentcontrol   2.6447     0.4217   6.271 9.25e-05 ***
litterlitterB          NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7304 on 10 degrees of freedom
Multiple R-squared:  0.7973,    Adjusted R-squared:  0.777 
F-statistic: 39.33 on 1 and 10 DF,  p-value: 9.247e-05</code></pre>
</div>
</div>
</section>
<section id="a-more-realistic-example" class="slide level2">
<h2>A more realistic example</h2>
<ul>
<li class="fragment"><p><a href="https://www.pnas.org/doi/10.1073/pnas.1413624111">Lin et al.&nbsp;(2014)</a> studied the gene expression of several tissues across mice and humans</p></li>
<li class="fragment"><p>The question they asked was whether the transcriptome is more similar for a tissue across species or for a species across tissues.</p></li>
<li class="fragment"><p>Perhaps surprisingly, the study concluded that “differences dominate similarities between the two species […] likely reflecting the fundamental physiological differences between these two organisms”.</p></li>
</ul>
</section>
<section id="a-more-realistic-example-1" class="slide level2">
<h2>A more realistic example</h2>

<img data-src="img/lin_pnas1.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="a-more-realistic-example-2" class="slide level2">
<h2>A more realistic example</h2>
<p><a href="https://f1000research.com/articles/4-121">Gilad &amp; Mizrahi-Man</a> reanalyzed the data and found that <em>species is confounded with sequencing batch</em>.</p>

<img data-src="img/gilad1.gif" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="a-more-realistic-example-3" class="slide level2">
<h2>A more realistic example</h2>
<p>If we adjust for the “batch effect”, we remove the species difference, but is this real?</p>

<img data-src="img/gilad2.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="what-can-we-conclude" class="slide level2">
<h2>What can we conclude?</h2>

<img data-src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExOGM2Y3VwcXFiemVwZTE0Mmhybzl6MGR1d2xmZmZqZHpsbWJqbzdjaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/K6VhXtbgCXqQU/giphy.gif" class="r-stretch"></section></section>
<section>
<section id="principles-of-experimental-design" class="title-slide slide level1 center">
<h1>Principles of experimental design</h1>

</section>
<section id="the-steps-of-experimental-design" class="slide level2 scrollable">
<h2>The steps of experimental design</h2>
<ol type="1">
<li class="fragment"><p><strong>Design</strong> – choices you make <em>before</em> collecting the data</p>
<ul>
<li class="fragment">What measurement to make (the response)?</li>
<li class="fragment">What conditions to compare (the treatment)?</li>
<li class="fragment">What is a unit that will get a treatment (individual person? groups of people, like a hospital?)</li>
<li class="fragment">How many samples do I need?</li>
<li class="fragment">Which units get which (combination) of treatments?</li>
</ul></li>
<li class="fragment"><p><strong>Running the experiment</strong></p></li>
<li class="fragment"><p><strong>Analysis</strong> – how you analyze the data created from a particular design to answer the scientific question.</p></li>
</ol>
</section>
<section id="back-to-the-toy-example" class="slide level2">
<h2>Back to the toy example</h2>
<ul>
<li class="fragment">What measurement to make (the response)?</li>
<li class="fragment">What conditions to compare (the treatment)?</li>
<li class="fragment">What is a unit that will get a treatment?</li>
<li class="fragment">How many samples do I need?</li>
<li class="fragment">Which units get which (combination) of treatments?</li>
</ul>
</section>
<section id="better-ways-to-design-the-experiment" class="slide level2 scrollable">
<h2>Better ways to design the experiment</h2>
<p>Now that we know that litter may cause confounding, we have three options.</p>
<ol type="1">
<li class="fragment"><em>Reduce technical variance</em>: we use for our experiments only mice from the same litter.</li>
<li class="fragment"><em>Randomization</em>: instead of assigning all mice from one litter to each treatment, we randomize the order.</li>
<li class="fragment"><em>Blocking</em>: we take pairs of mice from several litters and give the treatment to one of the two, randomly.</li>
</ol>
<div class="fragment">
<p><strong>What are the pros and cons of each option?</strong></p>
</div>
</section>
<section id="a-better-experiment-randomization" class="slide level2">
<h2>A better experiment: randomization</h2>

<img data-src="06_design_files/figure-revealjs/unnamed-chunk-6-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="a-better-experiment-randomization-1" class="slide level2">
<h2>A better experiment: randomization</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expression ~ treatment + litter, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0098 -1.5810  0.1103  0.9528  4.0417 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)         1.612      1.103   1.461    0.178
treatmentcontrol    2.193      1.274   1.722    0.119
litterlitterB      -1.488      1.274  -1.168    0.273

Residual standard error: 2.207 on 9 degrees of freedom
Multiple R-squared:  0.3248,    Adjusted R-squared:  0.1747 
F-statistic: 2.164 on 2 and 9 DF,  p-value: 0.1708</code></pre>
</div>
</div>
</section>
<section id="a-better-experiment-blocking" class="slide level2">
<h2>A better experiment: blocking</h2>

<img data-src="06_design_files/figure-revealjs/unnamed-chunk-8-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section>
<section id="a-better-experiment-blocking-1" class="slide level2">
<h2>A better experiment: blocking</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expression ~ treatment + litter, data = df)

Residuals:
        1         2         3         4         5         6         7         8 
-0.090933  0.032581  0.011479  0.007766  0.018634  0.020473  0.090933 -0.032581 
        9        10        11        12 
-0.011479 -0.007766 -0.018634 -0.020473 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       2.37867    0.04900  48.547 7.01e-08 ***
treatmentcontrol  0.68681    0.03704  18.543 8.39e-06 ***
litterlitterB    -0.11876    0.06415  -1.851   0.1234    
litterlitterC     0.21743    0.06415   3.389   0.0195 *  
litterlitterD    -0.09813    0.06415  -1.530   0.1867    
litterlitterE     0.09493    0.06415   1.480   0.1990    
litterlitterF     1.55474    0.06415  24.235 2.23e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06415 on 5 degrees of freedom
Multiple R-squared:  0.9963,    Adjusted R-squared:  0.9918 
F-statistic: 222.8 on 6 and 5 DF,  p-value: 6.639e-06</code></pre>
</div>
</div>
</section>
<section id="a-better-experiment-blocking-2" class="slide level2">
<h2>A better experiment: blocking</h2>
<p>If we don’t include litter, we lose power, but the treatment effect is correctly estimated.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = expression ~ treatment, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.42637 -0.36554 -0.19142 -0.06334  1.30017 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        2.6537     0.2616  10.143  1.4e-06 ***
treatmentcontrol   0.6868     0.3700   1.856   0.0931 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6409 on 10 degrees of freedom
Multiple R-squared:  0.2562,    Adjusted R-squared:  0.1819 
F-statistic: 3.445 on 1 and 10 DF,  p-value: 0.0931</code></pre>
</div>
</div>
</section>
<section id="side-note" class="slide level2 smaller">
<h2>Side note</h2>
<p><strong>This is exactly the difference between a two-sample and a paired t-test!</strong></p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  df_wide$treated and df_wide$control
t = -1.8562, df = 9.9906, p-value = 0.09313
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -1.511352  0.137741
sample estimates:
mean of x mean of y 
 2.653702  3.340508 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Paired t-test

data:  df_wide$treated and df_wide$control
t = -18.543, df = 5, p-value = 8.394e-06
alternative hypothesis: true mean difference is not equal to 0
95 percent confidence interval:
 -0.7820154 -0.5915956
sample estimates:
mean difference 
     -0.6868055 </code></pre>
</div>
</div>
</section>
<section id="what-have-we-done" class="slide level2">
<h2>What have we done?</h2>
<p>An experiment like this is called <strong>randomized block design</strong>.</p>
<div class="fragment">
<p>The variable <em>litter</em> is the <strong>blocking variable</strong>.</p>
</div>
<div class="fragment">
<p>Each treatment is applied within each block.</p>
</div>
<div class="fragment">
<p><em>Randomization</em> and <em>blocking</em> are the two main devices of experimental design.</p>
</div>
</section></section>
<section>
<section id="randomization-vs-blocking" class="title-slide slide level1 center">
<h1>Randomization vs Blocking</h1>

</section>
<section id="randomization-vs-blocking-1" class="slide level2">
<h2>Randomization vs Blocking</h2>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Quote</strong></p>
</div>
<div class="callout-content">
<p>“Block what you can, randomize what you cannot.”</p>
<p>George Box (1978)</p>
</div>
</div>
</div>
<p>In a <strong>Randomized Complete Block Design</strong> the <em>experimental units</em> are blocks sampled at random from the population.</p>
<p>Treatments are then assigned at random to the <em>observational units</em> within each block.</p>
</section>
<section id="randomized-complete-block-designs" class="slide level2">
<h2>Randomized Complete Block Designs</h2>
<p><strong>Each treatment is applied to each block exactly once</strong>.</p>

<img data-src="img/CompleteRB3.png" data-fig-algin="center" class="r-stretch"><p>Paired designs are a special case with two treatments.</p>
</section>
<section id="completely-randomized-design" class="slide level2">
<h2>Completely Randomized Design</h2>
<ul>
<li class="fragment"><p>Sometimes it is not possible or practicle to block, e.g.,<br>
</p>
<ul>
<li class="fragment">we do not know the nuisance factor in advance</li>
<li class="fragment">we cannot assign a treatment to a block more than once</li>
</ul></li>
<li class="fragment"><p>In such cases, we can use <em>randomization</em>, i.e., assign the treatment randomly to each experimental unit.</p></li>
<li class="fragment"><p>Randomization decreases (unconscious) bias and helps with <em>unknown</em> nuisance factors.</p></li>
</ul>
</section>
<section id="blocking-leads-to-more-power" class="slide level2">
<h2>Blocking leads to more power</h2>
<ul>
<li class="fragment"><p>We have seen in the mouse toy example that blocking for the litter effect led to a smaller p-value.</p></li>
<li class="fragment"><p>In general, blocking leads to <strong>more power</strong> than randomization.</p></li>
<li class="fragment"><p>We can simulate some data to empirically show this effect.</p></li>
</ul>
</section>
<section id="simulation-study" class="slide level2">
<h2>Simulation study</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">1547</span>)</span>
<span id="cb8-2"><a href=""></a>B <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-3"><a href=""></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb8-4"><a href=""></a>n <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb8-5"><a href=""></a>effect <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb8-6"><a href=""></a>pvals <span class="ot">&lt;-</span> <span class="fu">replicate</span>(B, {</span>
<span id="cb8-7"><a href=""></a>    litters <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb8-8"><a href=""></a>    noiset <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.25</span>)</span>
<span id="cb8-9"><a href=""></a>    noisec <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.25</span>)</span>
<span id="cb8-10"><a href=""></a>    treated <span class="ot">&lt;-</span> litters <span class="sc">+</span> effect <span class="sc">+</span> noiset</span>
<span id="cb8-11"><a href=""></a>    controls  <span class="ot">&lt;-</span> litters <span class="sc">+</span> noisec</span>
<span id="cb8-12"><a href=""></a>    </span>
<span id="cb8-13"><a href=""></a>    <span class="fu">c</span>(<span class="fu">t.test</span>(treated, controls, <span class="at">paired=</span><span class="cn">FALSE</span>)<span class="sc">$</span>p.value,</span>
<span id="cb8-14"><a href=""></a>      <span class="fu">t.test</span>(treated, controls, <span class="at">paired=</span><span class="cn">TRUE</span>)<span class="sc">$</span>p.value)</span>
<span id="cb8-15"><a href=""></a>})</span>
<span id="cb8-16"><a href=""></a><span class="fu">rowMeans</span>(pvals <span class="sc">&lt;=</span> alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000 0.557</code></pre>
</div>
</div>
</section>
<section id="simulation-study-1" class="slide level2">
<h2>Simulation study</h2>

<img data-src="06_design_files/figure-revealjs/unnamed-chunk-13-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:75.0%"></section></section>
<section>
<section id="replication" class="title-slide slide level1 center">
<h1>Replication</h1>

</section>
<section id="how-many-replicates-do-i-need" class="slide level2">
<h2>How many replicates do I need?</h2>
<iframe data-external="1" src="https://www.youtube.com/embed/Hz1fyhVOjr4" width="100%" height="85%" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</section>
<section id="the-right-question-to-ask" class="slide level2">
<h2>The right question to ask</h2>
<ul>
<li class="fragment"><p>How many replicates do I need to detect <em>this</em> effect given that the data exhibit <em>this</em> variability?</p></li>
<li class="fragment"><p>In other words, the power to detect a difference depends on the effect size and the variance, in addition to sample size.</p></li>
<li class="fragment"><p>Intuitively, we need few replicates when comparing well-controlled cell lines, many more when performing an observational studies in a heterogeneous human population.</p></li>
</ul>
</section>
<section id="power-calculations" class="slide level2">
<h2>Power calculations</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="fu">power.t.test</span>(<span class="at">n =</span> <span class="dv">3</span>, <span class="at">delta =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 3
          delta = 1
             sd = 0.5
      sig.level = 0.05
          power = 0.4626081
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
</section>
<section id="sample-size-calculations" class="slide level2">
<h2>Sample size calculations</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.5</span>, <span class="at">power =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 6.386756
          delta = 1
             sd = 0.5
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
</section>
<section id="sample-size-calculation" class="slide level2">
<h2>Sample size calculation</h2>
<p>It may not be obvious what are the expected effect size and variability.</p>
<p>In such cases, <strong>pilot experiments</strong> may be useful.</p>
</section>
<section id="technical-vs.-biological-replicates" class="slide level2">
<h2>Technical vs.&nbsp;biological replicates</h2>
<p>Not all replicates are equal!</p>

<img data-src="img/tech_bio.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="experimental-vs.-observational-units" class="slide level2">
<h2>Experimental vs.&nbsp;observational units</h2>
<ul>
<li class="fragment"><p><strong>Experimental units</strong> are the smallest entities that can be <em>independently</em> assigned to a treatment (e.g., animal, litter, …)</p></li>
<li class="fragment"><p><strong>Observational units</strong> are the units at which measurements are made.</p></li>
</ul>
<div class="fragment">
<p>Think of single-cell molecular assays: we measure e.g.&nbsp;gene expression at the individual cell level, but we are typically interested in treatments at the animal or tissue level.</p>
</div>
</section>
<section id="technical-vs.-biological-replicates-1" class="slide level2">
<h2>Technical vs.&nbsp;biological replicates</h2>
<ul>
<li class="fragment"><p>Biological replication is required to make a general statement of the effect of a treatment</p></li>
<li class="fragment"><p>You can’t draw a conclusion about the effect of a compound on people in general by observing the effect in one person.</p></li>
<li class="fragment"><p><strong>Only replication of experimental units is true replication (independent error terms).</strong></p></li>
</ul>
</section>
<section id="pseudo-replication" class="slide level2">
<h2>Pseudo replication</h2>
<ul>
<li class="fragment"><p>Only experimental units are independent.</p>
<ul>
<li class="fragment">E.g., cells from the same mouse are more correlated to each other than to cells from a different mouse.</li>
</ul></li>
<li class="fragment"><p>A sample of <em>independent</em> observations is more informative than one of <em>dependent</em> ones.</p></li>
<li class="fragment"><p>Example: ask the political opinion of <span class="math inline">\(n\)</span> people randomly picked from <span class="math inline">\(n\)</span> independent locations vs.&nbsp;<span class="math inline">\(3\)</span> randomly picked locations and <span class="math inline">\(n/3\)</span> people randomly picked at each location.</p></li>
</ul>
</section>
<section id="nested-designs" class="slide level2">
<h2>Nested designs</h2>
<ul>
<li class="fragment"><p>Although less ideal than Randomized Complete Block Designs, <em>nested</em> (or <em>split-plot</em>) designs are common and describe a situation similar to what we just described.</p></li>
<li class="fragment"><p>Nested designs may be more convenient, for instance in education we are interested in measuring effects on children, but children are taught in classrooms, hence we often cannot apply treatments at the child level, but at the school or teacher level.</p></li>
</ul>
</section>
<section id="nested-design-an-example" class="slide level2">
<h2>Nested design: an example</h2>
<p>An experiment compares the ability of two technologies to detect diabetes in dogs. Ten dogs are randomly divided into two groups: in one group they induce diabetes.</p>
<p><strong>What kind of design can we use?</strong></p>
</section>
<section id="nested-design-an-example-1" class="slide level2 scrollable">
<h2>Nested design: an example</h2>
<ol type="1">
<li class="fragment"><p><strong>Completely Randomized</strong>: 2 technologies <span class="math inline">\(\times\)</span> diabetic or not, hence 4 treatment combinations: randomly assign a treatment combination to a dog. Don’t we want to block for the dog effect (individual effects are important!)?</p></li>
<li class="fragment"><p><strong>Complete Block</strong>: for each dog, randomly assign each treatment combinations. Ideal but not possible, a dog is either diabetic or not.</p></li>
<li class="fragment"><p><strong>Nested Design</strong>: each dog gets randomly assign diabetes or not, but then measure each dog with both technology.</p></li>
</ol>
</section>
<section id="designs-are-about-constraints" class="slide level2">
<h2>Designs are about constraints</h2>
<ul>
<li class="fragment"><p>We have a nested design because we cannot perform a complete block design.</p></li>
<li class="fragment"><p>The consequence is that we now have pseudo-replication: we measure each dog twice, but the treatment is at the dog level.</p></li>
<li class="fragment"><p>We will see that <em>random effect</em> and <em>mixed effect</em> models are one way to deal with pseudo-replication.</p></li>
<li class="fragment"><p>One particular case of pseudo-replication is <em>longitudinal data</em>, in which each experimental unit is measured across time.</p></li>
</ul>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="06_design_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="06_design_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="06_design_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="06_design_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>